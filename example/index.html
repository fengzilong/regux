<html>
<head>
	<meta charset="utf-8">
	<title>regux demo</title>
</head>
<body>
	<script type="text/javascript" src="./regular.js"></script>
	<script type="text/javascript" src="../dist/regux.js"></script>
	<script type="text/javascript" src="../logger.js"></script>
	<script type="text/javascript">
		Regular.use( regux );

		const getters = {
			count: function( state ) {
				return state.foo.bar;
			}
		};

		const App = Regular.extend({
			getters: getters,
			template: `
				<div>
					{ count }
					<button on-click="{ this.dispatch( 'add', 10 ) }">+</button>
					<button on-click="{ this.dispatch( 'subtract', 5 ) }">-</button>
				</div>
			`,
			events: {
				$update() {
					console.log( 'view updated' );
				}
			},
		});

		const foo = {
			state: { bar: 10 },
			reducers: {
				ADD2( state, payload ) {
					state.bar = state.bar + payload;
				},
				SUBTRACT2( state, payload ) {
					state.bar = state.bar - payload;
				}
			},
		};

		const store = new regux.Store({
			state: {
				c: 0
			},
			reducers: {
				ADD( state, payload ) {
					state.c = state.c + payload;
				},
				SUBTRACT( state, payload ) {
					state.c = state.c - payload;
				}
			},
			modules: {
				foo: foo
			},
			actions: {
				add( context, num ) {
					context.commit( 'foo/ADD2', num );
					context.commit( 'foo/ADD2', num );
					context.commit( 'foo/ADD2', num );
					context.commit( 'foo/SUBTRACT2', num );
					context.nextTick( function() {
					} );
				},
				subtract( context, num ) {
					context.commit( 'foo/SUBTRACT2', num );
				}
			},
			plugins: [ logger( { collapsed: true } ) ]
		});

		// inject store into child components on top level
		new App( { store: store } ).$inject( document.body );
	</script>
</body>
</html>
